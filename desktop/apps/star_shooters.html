<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Star Shooters</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: black;
  color: #00ffcc;
  font-family: "Courier New", monospace;
  overflow: hidden;
}

.screen {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
}

.screen.active {
  display: flex;
}

#hud {
  position: fixed;
  top: 10px;
  left: 10px;
  font-size: 14px;
  display: none;
}

button {
  background: black;
  color: #00ffcc;
  border: 2px solid #00ffcc;
  padding: 10px 20px;
  font-family: inherit;
  cursor: pointer;
}

canvas {
  display: none;
  margin: auto;
  background: radial-gradient(circle at center, #020b12, #000);
  border: 2px solid rgba(0,255,204,0.3);
}
</style>
</head>

<body>

<!-- START -->
<div id="startScreen" class="screen active">
  <h1>STAR SHOOTERS</h1>
  <p>CLICK TO START</p>
  <p style="opacity:0.5">TIP: SOME STARS AVOID YOU WHILE BEING OBSERVED</p>
</div>

<!-- HUD -->
<div id="hud">
  SCORE: <span id="score">0</span><br>
  TIME: <span id="time">30</span>
</div>

<!-- GAME -->
<canvas id="gameCanvas" width="640" height="360"></canvas>

<!-- END -->
<div id="endScreen" class="screen">
  <h2>GAME OVER</h2>
  <p>SCORE: <span id="finalScore">0</span></p>
  <p>CLICK TO RETURN</p>
</div>

<script>
/* ===== KONAMI ===== */
const KONAMI = [
  "ArrowUp","ArrowUp",
  "ArrowDown","ArrowDown",
  "ArrowLeft","ArrowRight",
  "ArrowLeft","ArrowRight",
  "b","a","Enter"
];

let konamiBuffer = [];

document.addEventListener("keydown", e => {
  if (!startScreen.classList.contains("active")) return;

  konamiBuffer.push(e.key);
  if (konamiBuffer.length > KONAMI.length) konamiBuffer.shift();

  if (KONAMI.every((k,i)=>k===konamiBuffer[i])) {
    window.open("secret.html","_blank");
    konamiBuffer = [];
  }
});

/* ===== ELEMENTS ===== */
const startScreen = document.getElementById("startScreen");
const endScreen = document.getElementById("endScreen");
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");
const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");
const finalScoreEl = document.getElementById("finalScore");

/* ===== STATE ===== */
let stars = [];
let score = 0;
let running = false;
let startTime = 0;
const DURATION = 30_000;

/* ===== STAR TYPES ===== */
function spawnStar() {
  const type = Math.random();
  stars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: 10 + Math.random()*8,
    dx: type < 0.3 ? (Math.random()-0.5)*0.6 : 0,
    dy: type < 0.3 ? (Math.random()-0.5)*0.6 : 0,
    shrink: type > 0.7,
    skittish: type > 0.4 && type < 0.6,
    scared: false
  });
}

/* ===== LOOP ===== */
function loop() {
  if (!running) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const elapsed = Date.now() - startTime;
  const remaining = Math.max(0, Math.ceil((DURATION - elapsed)/1000));
  timeEl.textContent = remaining;

  if (elapsed >= DURATION) {
    endGame();
    return;
  }

  stars.forEach(s => {
    s.x += s.dx;
    s.y += s.dy;

    if (s.shrink) s.r -= 0.02;

    ctx.beginPath();
    ctx.fillStyle = "#00ffcc";
    ctx.arc(s.x, s.y, Math.max(4,s.r), 0, Math.PI*2);
    ctx.fill();
  });

  stars = stars.filter(s => s.r > 4);
  requestAnimationFrame(loop);
}

/* ===== INPUT ===== */
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  stars.forEach(s => {
    if (s.skittish && !s.scared && Math.hypot(mx-s.x,my-s.y)<40) {
      s.x = Math.random()*canvas.width;
      s.y = Math.random()*canvas.height;
      s.scared = true;
    }
  });
});

canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  stars = stars.filter(s => {
    const hit = Math.hypot(mx-s.x,my-s.y) <= s.r;
    if (hit) {
      score++;
      scoreEl.textContent = score;
    }
    return !hit;
  });
});

/* ===== FLOW ===== */
function startGame() {
  score = 0;
  scoreEl.textContent = 0;
  stars = [];
  startTime = Date.now();
  running = true;

  startScreen.classList.remove("active");
  endScreen.classList.remove("active");
  canvas.style.display = "block";
  hud.style.display = "block";

  spawnStar();
  setInterval(()=>running && spawnStar(),800);
  loop();
}

function endGame() {
  running = false;
  canvas.style.display = "none";
  hud.style.display = "none";
  finalScoreEl.textContent = score;
  endScreen.classList.add("active");
}

startScreen.onclick = startGame;
endScreen.onclick = ()=>{
  endScreen.classList.remove("active");
  startScreen.classList.add("active");
};
</script>

</body>
</html>
